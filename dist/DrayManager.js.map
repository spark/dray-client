{"version":3,"sources":["../src/DrayManager.js"],"names":[],"mappings":";;;;;;;;;AAAA;;AACA;;;;AACA;;;;;;;;IAEa,W,WAAA,W;;;;;;;;AAOZ,sBAAY,OAAZ,EAAqB,QAArB,EAA+B;AAAA;;AAC9B,OAAK,QAAL,GAAgB,OAAhB;AACA,OAAK,SAAL,GAAiB,QAAjB;AACA,OAAK,MAAL,GAAc,uDAA8B,OAA9B,CAAd;AACA;;;;;;;;;;;;4BAQS,U,EAAY;AACrB,OAAI,MAAM,qBAAY,IAAZ,CAAV;AACA,OAAI,aAAJ,CAAkB,UAAlB;AACA,UAAO,GAAP;AACA;;;;;;;;;;6BAOU;AAAA;;AACV,UAAO,KAAK,QAAL,CAAc,MAAd,EAAsB,IAAtB,CAA2B,UAAC,KAAD,EAAW;AAC5C,WAAO,MAAM,GAAN,CAAU,IAAV,CAAe,GAAf,CAAmB,UAAC,IAAD,EAAU;AACnC,SAAI,MAAM,4BAAkB,IAAlB,CAAV;AACA,YAAO,GAAP;AACA,KAHM,CAAP;AAIA,IALM,EAKJ,KAAK,WALD,CAAP;AAMA;;;;;;;;;;;6BAQU,G,EAAK;AACf,UAAO,KAAK,QAAL,CAAc,MAAd,EAAsB,MAAtB,EAA8B,IAAI,MAAJ,EAA9B,EAA4C,IAA5C,CAAiD,UAAC,KAAD,EAAW;AAClE,WAAO,MAAP,CAAc,GAAd,EAAmB,MAAM,GAAN,CAAU,IAA7B;AACA,WAAO,GAAP;AACA,IAHM,EAGJ,KAAK,WAHD,CAAP;AAIA;;;;;;;;;;;6BAQU,G,EAAK;AACf,UAAO,KAAK,QAAL,WAAsB,IAAI,EAA1B,EAAgC,KAAhC,EAAuC,IAAvC,CAA4C,UAAC,KAAD,EAAW;AAC7D,WAAO,MAAM,GAAN,CAAU,IAAjB;AACA,IAFM,EAEJ,KAAK,WAFD,CAAP;AAGA;;;;;;;;;;;8BAQW,G,EAAK;AAChB,UAAO,KAAK,QAAL,WAAsB,IAAI,EAA1B,WAAoC,IAApC,CAAyC,UAAC,KAAD,EAAW;AAC1D,WAAO,MAAM,GAAN,CAAU,IAAV,CAAe,KAAtB;AACA,IAFM,EAEJ,KAAK,WAFD,CAAP;AAGA;;;;;;;;;;;;;2BAUQ,G,EAAmC;AAAA,OAA9B,MAA8B,yDAAvB,KAAuB;AAAA,OAAhB,IAAgB,yDAAX,SAAW;;AAC3C,UAAO,KAAK,MAAL,CAAY,MAAZ,EAAuB,KAAK,QAA5B,SAAwC,GAAxC,EAA+C,IAA/C,EAAqD,GAArD,EAAP;AACA;;;8BAEW,M,EAAQ;AACnB,UAAO,QAAQ,MAAR,CAAe,MAAf,CAAP;AACA","file":"DrayManager.js","sourcesContent":["import { DrayJob } from './DrayJob';\nimport superagent from 'superagent';\nimport superagentPromise from 'superagent-promise';\n\nexport class DrayManager {\n\t/**\n\t * DrayManager class constructor.\n\t *\n\t * @param {String} drayUrl URL for Dray instance\n\t * @param {String} redisUrl URL for Redis instance\n\t */\n\tconstructor(drayUrl, redisUrl) {\n\t\tthis._drayUrl = drayUrl;\n\t\tthis._redisUrl = redisUrl;\n\t\tthis._agent = superagentPromise(superagent, Promise);\n\t}\n\n\t/**\n\t * Instantiate, set parameters and return {DrayJob}\n\t *\n\t * @param {Object} parameters Parameters to set\n\t * @returns {DrayJob} Job ready to execute\n\t */\n\tcreateJob(parameters) {\n\t\tlet job = new DrayJob(this);\n\t\tjob.setParameters(parameters);\n\t\treturn job;\n\t}\n\n\t/**\n\t * List submitted Dray jobs\n\t *\n\t * @returns {Promise} Resolves into {Array} of jobs\n\t */\n\tlistJobs() {\n\t\treturn this._request('jobs').then((value) => {\n\t\t\treturn value.res.body.map((item) => {\n\t\t\t\tlet job = new DrayJob(this, item);\n\t\t\t\treturn job;\n\t\t\t});\n\t\t}, this._onRejected);\n\t}\n\n\t/**\n\t * Submit the job to Dray\n\t *\n\t * @param {DrayJob} job Job to submit\n\t * @returns {Promise} Resolves to {DrayJob} if success\n\t */\n\t_submitJob(job) {\n\t\treturn this._request('jobs', 'post', job.toJSON()).then((value) => {\n\t\t\tObject.assign(job, value.res.body);\n\t\t\treturn job;\n\t\t}, this._onRejected);\n\t}\n\n\t/**\n\t * Delete job from Dray\n\t *\n\t * @param {DrayJob} job Job to delete\n\t * @returns {Promise} Resolves with Dray result\n\t */\n\t_deleteJob(job) {\n\t\treturn this._request(`jobs/${job.id}`, 'del').then((value) => {\n\t\t\treturn value.res.body;\n\t\t}, this._onRejected);\n\t}\n\n\t/**\n\t * Get logs for specified job\n\t *\n\t * @param {DrayJob} job Job for which to get logs\n\t * @returns {Promise} Resolves to and {Array} containing logs\n\t */\n\t_getJobLogs(job) {\n\t\treturn this._request(`jobs/${job.id}/log`).then((value) => {\n\t\t\treturn value.res.body.lines;\n\t\t}, this._onRejected);\n\t}\n\n\t/**\n\t * Send a request to Dray instance\n\t *\n\t * @param {String} url URL appended to Dray's URL\n\t * @param {String} method (optional) HTTP method, defaults to GET\n\t * @param {Mixed}  data (optional) Data to be passed\n\t * @returns {Promise} resolved with request response\n\t */\n\t_request(url, method='get', data=undefined) {\n\t\treturn this._agent[method](`${this._drayUrl}/${url}`, data).end();\n\t}\n\n\t_onRejected(reason) {\n\t\treturn Promise.reject(reason);\n\t}\n}\n"]}